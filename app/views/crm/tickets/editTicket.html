<div ng-controller="EditTicketController">
	<div>
		<ul class="breadcrumb">
			<table>
				<tr>
					<td><img ng-hide="imagePresent"
						src="../app/images/blank_avatar.jpg" alt="Avatar" width="40">
						<img ng-show="imagePresent" src="{{image}}" alt="Avatar"
						width="40"></td>
					<td><small style="color: black;">{{displayName}}</small>
						&nbsp; <i class="icon-circle {{statusActive | StatusLookup}}"></i>
					</td>
					<td><small style="font-size: 30px;">|</small></td>
					<td>
						<table>
							<tr>
								<td><small>Uniquely identified {{accountNo}}</small></td>
							</tr>
							<tr>
								<td><i class="icon-building"></i><small>Office
										"{{officeName}}"</small></td>
							</tr>
						</table>
					</td>
					<td><small style="font-size: 30px;">|</small></td>
					<td>
						<table>
							<tr>
								<td><small>Cell Phone {{phone}}</small></td>
							</tr>
							<tr>
								<td><small>Device # <strong>{{hwSerialNumber}}</strong></small></td>
							</tr>
						</table>
					</td>
					<td><small style="font-size: 30px;">|</small></td>
					<td>
						<table>
							<tr>
								<td><small>Client Type "{{categoryType}}"</small></td>
							</tr>
							<tr>
								<td><small>Balance&nbsp;{{balanceAmount}}&nbsp;{{currency}}
								</small></td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</ul>
		<ul class="breadcrumb">
			<li><a href="#/clients">{{'link.clients' | translate}}</a> <span
				class="divider">/</span></li>
			<li><a href="#/assignedtickets" ng-click="reset123()">{{'link.view.tickets'
					| translate}}</a> <span class="divider">/</span></li>
			<li class="active">{{'label.editticket' | translate}}</li>
		</ul>
	</div>
	<form name="editticketform" class="form-horizontal well"
		ng-submit="submit()">
		<div class="error" ng-show="errorStatus || errorDetails">
			<label>{{'label.contract.error' | translate}}</label> <label
				ng-show="errorStatus">{{errorStatus}}</label> <label
				ng-hide="errorStatus" ng-repeat="error in errorDetails">{{error.code
				| translate}}</label>
		</div>
		<!-- <div class="pull-right" style="width:15%">
				  <a ng-click="history()" class="btn btn-primary"><i
					class=" icon-list"></i>History</a>
			   </div> -->
		<fieldset>
			<legend><strong>Edit Ticket</strong>
			 <a ng-click="history()" class="btn btn-primary pull-right"><i
					class=" icon-list"></i>History</a></legend>
			<table width="100%">
				<tr>
					<td width="25%">
						<div class="control-group">
							<label class="control-label" for="id">{{'label.ticket.issueid'| translate }}</label>
							<div class="controls">
								<input type="text" name="issueid" ng-model="formData.id"
									readonly value="{{ticket.id}}">
							</div>
						</div>
					</td>
					<td width="25%">
						<div class="control-group">
							<label class="control-label" for="status">
								{{'label.ticket.status' | translate }}<span class="required">*</span> </label>
							<div class="controls">
								<select ng-model="formData.status"
									ng-options="statusData.mCodeValue as statusData.mCodeValue for statusData in statusTypes"
									data-ng-readonly="formData.status=='CLOSED'"
									value="{{statusData.statusCode}}" required late-Validate></select>
							</div>
						</div>
					</td>
				</tr>
				<tr>
					<td width="25%">
						<div class="control-group">
							<label class="control-label" for="Category">
								{{'label.ticket.category' | translate }}<span class="required">*</span>
							</label>
							<div class="controls">
								<select name="category" ng-model="formData.problemCode"
									ng-options="problemsData.id as problemsData.mCodeValue for problemsData in problemsDatas"
									data-ng-readonly="formData.status=='CLOSED'"
									value="{{problemsData.problemCode}}" required late-Validate></select>
							</div>
						</div>
					</td>
					<td width="25%">
						<div class="control-group">
							<label class="control-label" for="priority">{{'label.ticket.priority'
								| translate }}<span class="required">*</span>
							</label>
							<div class="controls">
								<select name="priority" ng-model="formData.priority"
									ng-options="priorityType.value as priorityType.value for priorityType in priorityTypes"
									data-ng-readonly="formData.status=='CLOSED'"
									value="{{priorityType.value}}" required late-Validate></select>
							</div>
						</div>
					</td>
				</tr>
				<tr>
					<td width="25%">
						<div class="control-group">
							<label class="control-label" for="assignedTo">{{'label.tickethistory.assignto'
								| translate }}<span class="required">*</span>
							</label>
							<div class="controls">
								<select ng-model="formData.userId"
									ng-options="users.id as users.userName for users in usersData"
									data-ng-readonly="formData.status=='CLOSED'"
									value="{{users.id}}" required late-Validate></select>
							</div>
						</div>
					</td>
					<td width="60%">
						<div class="control-group">
							<label class="control-label" for="Date">{{'label.ticket.date' | translate }}</label>
							<div class="controls">
								<input name="date" ng-model="formData.ticketDate" readonly
									value="{{data.ticketDate}}">
							</div>
						</div>
					</td>
				</tr>
				<tr>      
			      <td width="25%">
			         <div class="control-group">
						<label class="control-label" for="description">{{'label.ticket.shortdescription' | translate }}</label>
						<div class="controls">
						   <textarea data-ng-model="formData.statusDescription" name="description" value="{{data.statusDescription}}"
						        style="width:103%; height:2em;" readonly></textarea>
						</div>
					 </div>
				  </td>
			    </tr>
			</table>
			<table width="100%">
				<tr>
					<td width="100%">
						<div class="control-group">
							<label class="control-label" for="issue">{{'label.ticket.issue'| translate }} </label>
							<div class="controls">
								<textarea ng-model="formData.issue" name="issue" value="{{data.issue}}"
									style="width: 194%; height: 4em;" readonly ></textarea>
							</div>
						</div>
					</td>
				</tr>
				<!-- <tr>
					<td width="100%">
						<div class="control-group" 
							data-ng-hide="formData.status=='CLOSED'">
							<label class="control-label" for="comments">{{'label.ticket.comments'| translate }}</label>
							<div class="controls">
								<textarea ng-model="formData.comments" name="comments" //value="{{data.comments}}//"
									style="width: 80%; height: 2em;" ></textarea>
							</div>
						</div>
					</td>
				</tr> -->
				<tr>
					<td width="20%">
						<div class="control-group" data-ng-hide="formData.status=='CLOSED'">
							<label class="control-label" for="Comments">{{'label.ticket.comments' | translate }}</label>
							<div class="controls">
								 <a ng-click="comment()" class="btn btn-primary">Comment</a>
							</div>
						</div>
					</td>
					<td width="50%">
						<div class="control-group">
							<label class="control-label" for="Attachments">
								{{'label.ticket.file' | translate }}</label>
							<div class="controls">
								<input type="file" ng-file-select="onFileSelect($files)">
							</div>
						</div>
					</td>
				</tr>
			</table>
			<div class="pull-right">
				<a href="#/assignedtickets"><button type="reset" class="btn"
						data-ng-click="reset123()">Cancel</button></a>
				<button type="submit"
					data-ng-disabled="!editticketform.$valid" class="btn btn-primary">Save</button>
				<!--  <a  ng-click="history()" class="btn btn-primary"><i class=" icon-repeat icon-white"></i> Terminate</a>  -->
			</div>
	<div class="row paddedleft">
    	<h3>&nbsp;&nbsp;&nbsp;<strong>{{'label.comment.history' | translate}}</strong></h3>
     <table class="table">
         <thead>
            <tr class="graybg">
		        <th width="30%">{{'label.tickethistory.date' | translate}}</th>
		        <th>{{'label.tickethistory.commentedby' | translate}}</th>
		        <th>{{'label.tickethistory.comments' | translate}}</th>
	      </tr>
        </thead>
        <tbody>
            <tr ng-repeat="history in historyData  | filter:filterText" data-ng-hide="formData.comments=='undefined'">    
                <td>{{history.createdDate | date : 'dd/MM/yy'}}</td>  
                <td>{{history.assignedTo}}</td>
                <td>{{history.statusDescription}}</td>
            </tr>
        </tbody>
        </table>
    </div>
		</fieldset>
   	</form>
   	</div>
<script type="text/ng-template" id="history.html">
<div class="modal-header silver">
        <h3 class="bolder"><strong>{{'label.tickethistory' | translate}}</strong></h3>
 <div style="position: absolute; top: 0; right: 0;">		
<button id="cancel" class="md-icon-button md-accent close-modal-button md-button md-default-theme" ng-click="ok()" tabindex="0"><i class="icon-remove icon-white"></i></button>
    </div></div><br/>
   <div class="pp_pic_holder dark_rounded" align="center"style="top: 0px; left: 279px; display: block; width: 600px; opacity: 1;">
       <fieldset>
        <table class="table"  width="130%">
         <thead>
            <tr class="graybg">
		        <th style="text-align: center" colspan="1">{{'label.tickethistory.date' | translate}}</th>
                <th style="text-align: center" colspan="1">{{'label.tickethistory.repotedby' | translate}}</th>
		        <th style="text-align: center" colspan="1">{{'label.tickethistory.assignto' | translate}}</th>
                <th style="text-align: center" colspan="1">{{'label.tickethistory.status' | translate}}</th>
	      </tr>
        </thead>
        <tbody >
            <tr ng-repeat="history in historyData  | filter:filterText">    
                <td style="text-align: center" colspan="1">{{history.createdDate | date : 'dd/MM/yy'}}</td>
                <td style="text-align: center" colspan="1">{{history.assignFrom}}</td>  
                <td style="text-align: center" colspan="1">{{history.assignedTo}}</td>
                <td style="text-align: center" colspan="1">{{history.status}}</td>
            </tr>
       	</tbody>
        </table>     
     	</fieldset>
    </div>
   
</script>
<script type="text/ng-template" id="comment.html">
<div class="modal-header silver">
<div class="modal-body" style="height:285px;">
        	<div class="control-group">
				<div class="controls">
					<label class="control-label" style="color:red;" ng-show="error.length>0">{{error | translate}}</label>
				</div>	
			</div>
    <tr>
		<td width="50%">
			<div class="control-group" 
				data-ng-hide="formData.status=='CLOSED'">
				<label class="control-label" for="comments"><strong>{{'label.ticket.comments'| translate }}</strong></label>
				   <div class="controls">
					  <textarea ng-model="formData.comments" name="comments" value="{{data.comments}}"
						style="width: 95%; height: 8em;" ></textarea>
				   </div>
			</div>
		</td>
	</tr>
   <div class="modal-footer">
          <button id="cancel" class="btn btn-warning" ng-click="cancel()">{{'button.cancel' | translate}}</button>
     	  <button id="submit" data-ng-disabled="commentform.$dirty && commentform.$invalid" ng-click="submit()" class="btn btn-primary">{{'label.confirm' | translate}}</button>
    </div>
</div>
</script>

